library(rpart)
library(rpart.plot)
library(tidyverse)
titanic_set <- read_csv('data/titanic_decision_tree_data.csv')
shuffle_index <- sample(1:nrow(titanic_set))
# shuffle the data so class order isn't in order - need this for training/testing split later on
titanic_set <- titanic_set[shuffle_index, ]
titanic_set %>% head()
titanic_set %>%
filter(!is.na(survived))
titanic_set %>%
filter(!is.na(survived)) %>%
mutate(across(c(sex, survived, pclass, embarked), as.factor(.x)))
mutate(across(c(sex, survived, pclass, embarked), as.factor)
mutate(across(c(sex, survived, pclass, embarked), as.factor)
titanic_set %>%
filter(!is.na(survived)) %>%
mutate(across(c(sex, survived, pclass, embarked), as.factor))
titanic_set %>%
filter(!is.na(survived)) %>%
mutate(across(c(sex, survived, pclass, embarked), as.factor)) %>%
mutate(age_status = if_else(age <= 16, "child", "adult"), .after = age)
titanic_set <- read_csv('data/titanic_decision_tree_data.csv') %>% janitor::clean_names()
titanic_set %>% head()
titanic_set %>%
filter(!is.na(survived)) %>%
mutate(across(c(sex, survived, pclass, embarked), as.factor)) %>%
mutate(age_status = if_else(age <= 16, "child", "adult"), .after = age) %>%
select(-c(x1, passenger_id, name, ticket, fare, cabin))
titanic_set %>%
filter(!is.na(survived)) %>%
mutate(across(c(sex, survived, pclass, embarked), as.factor)) %>%
mutate(age_status = if_else(age <= 16, "child", "adult"), .after = age) %>%
select(-c(x1, passenger_id, name, ticket, fare, cabin)) %>%
across(drop_na)
titanic_set %>%
filter(!is.na(survived)) %>%
mutate(across(c(sex, survived, pclass, embarked), as.factor)) %>%
mutate(age_status = if_else(age <= 16, "child", "adult"), .after = age) %>%
select(-c(x1, passenger_id, name, ticket, fare, cabin)) %>%
drop_na(across(.x))
titanic_set %>%
filter(!is.na(survived)) %>%
mutate(across(c(sex, survived, pclass, embarked), as.factor)) %>%
mutate(age_status = if_else(age <= 16, "child", "adult"), .after = age) %>%
select(-c(x1, passenger_id, name, ticket, fare, cabin)) %>%
na.omit()
titanic_set <- titanic_set %>%
filter(!is.na(survived)) %>%
mutate(across(c(sex, survived, pclass, embarked), as.factor)) %>%
mutate(age_status = if_else(age <= 16, "child", "adult"), .after = age) %>%
select(-c(x1, passenger_id, name, ticket, fare, cabin)) %>%
na.omit()
titanic_set %>%
count(sex, survived)
library(janitor)
titanic_set %>%
tabyl(sex, survived)
titanic_set %>%
tabyl(sex, survived) %>%
adorn_percentages()
titanic_set %>%
tabyl(sex, survived) %>%
adorn_crosstab()
titanic_set %>%
tabyl(sex, survived) %>%
adorn_pct_formatting()
titanic_set %>%
tabyl(sex, survived) %>%
adorn_percentages()
titanic_set %>%
tabyl(pclass, survived)
titanic_set %>%
tabyl(pclass, survived) %>%
adorn_percentages()
titanic_set %>%
tabyl(embarked, survived) %>%
adorn_percentages()
titanic_set %>%
tabyl(age_status, survived) %>%
adorn_percentages()
titanic_set
titanic_set %>%
tabyl(sex, survived) %>%
adorn_percentages()
titanic_set %>%
tabyl(sex, pclass, survived)
titanic_set %>%
tabyl(parch, age_status, survived)
titanic_set %>%
tabyl(sex, pclass, survived) %>%
adorn_percentages()
titanic_set %>%
tabyl(sex, pclass, survived)
n_data <- nrow(titanic_set)
test_index <- sample(1:ndata, size = n_data * 0.20)
test_index <- sample(1:n_data, size = n_data * 0.20)
titanic_test <- slice(titanic_set, test_index)
titanic_train <- slice(titanic_set, -test_index)
titanic_test %>%
tabyl(survived)
titanic_test %>%
tabyl(survived)
titanic_train %>%
tabyl(survived)
test_index <- sample(1:n_data, size = n_data * 0.10)
titanic_test <- slice(titanic_set, test_index)
titanic_train <- slice(titanic_set, -test_index)
#check that sets are balanced
titanic_test %>%
tabyl(survived)
titanic_train %>%
tabyl(survived)
test_index <- sample(1:n_data, size = n_data * 0.10)
titanic_test <- slice(titanic_set, test_index)
titanic_train <- slice(titanic_set, -test_index)
titanic_test %>%
tabyl(survived)
titanic_train %>%
tabyl(survived)
test_index <- sample(1:n_data, size = n_data * 0.10)
titanic_test <- slice(titanic_set, test_index)
titanic_train <- slice(titanic_set, -test_index)
titanic_test %>%
tabyl(survived)
titanic_train %>%
tabyl(survived)
test_index <- sample(1:n_data, size = n_data * 0.10)
titanic_test <- slice(titanic_set, test_index)
titanic_train <- slice(titanic_set, -test_index)
titanic_test %>%
tabyl(survived)
titanic_train %>%
tabyl(survived)
titanic_fit <- rpart(
formula = survived ~ .,
data = titanic_train,
method = "class"
)
titanic_fit
rpart.plot(titanic_fit,
yesno = 2,
fallen.leaves = TRUE,
faclen = 6,
digits = 4)
rpart.plot(titanic_fit,
yesno = 1,
fallen.leaves = TRUE,
faclen = 6,
digits = 4)
rpart.plot(titanic_fit,
yesno = 2,
fallen.leaves = TRUE,
faclen = 6,
digits = 4)
titanic_train %>%
mutate(survived = factor(survived, levels = c(0, 1), labels = c("No", "Yes")))
titanic_train %>%
mutate(survived_flag = factor(survived, levels = c(0, 1), labels = c("No", "Yes")))
titanic_train <- titanic_train %>%
mutate(survived = factor(survived, levels = c(0, 1), labels = c("No", "Yes")))
titanic_fit <- rpart(
formula = survived ~ .,
data = titanic_train,
method = "class"
)
rpart.plot(titanic_fit,
yesno = 2,
fallen.leaves = TRUE,
faclen = 6,
digits = 4)
rpart.rules(titanic_fit, cover = TRUE)
library(modelr)
titanic_test_pred <- titanic_test %>%
add_predictions(titanic_fit, type = class)
titanic_test_pred <- titanic_test %>%
add_predictions(titanic_fit, type = "class")
titanic_test_pred
library(yardstick)
conf_mat <- titanic_test_pred %>%
conf_mat(truth = survived,
estimate = pred)
titanic_test <- titanic_test %>%
mutate(survived = factor(survived, levels = c(0, 1), labels = c("No", "Yes")))
titanic_test_pred <- titanic_test %>%
add_predictions(titanic_fit, type = "class")
conf_mat <- titanic_test_pred %>%
conf_mat(truth = survived,
estimate = pred)
conf_mat
36/(36 +8)
19/(19 + 8)
