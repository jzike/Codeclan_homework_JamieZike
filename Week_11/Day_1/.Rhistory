library(tidyverse)
library(modelr)
library(readxl)
telco_churn <- read_excel("data/telecomms_churn.xlsx") %>% janitor::clean_names()
telco_clean <- telco_churn %>%
filter(!is.na(total_charges)) %>%
select(-customer_id) %>%
mutate(across(where(is_character), as_factor)) %>%
mutate(senior_citizen = as_factor(if_else(senior_citizen == 1, "Yes", "No")))
head(telco_clean)
telco_clean %>% count(partner)
telco_clean %>% count(senior_citizen)
telco_clean %>%
group_by(partner, churn) %>%
summarise(number_churn = n())
telco_clean %>%
group_by(partner, churn) %>%
summarise(number_churn = n) %>%
ggplot(aes(x = partner,
y = number_churn,
fill = churn)) %>%
geom_col(position = position_dodge())
telco_clean %>%
group_by(partner, churn) %>%
summarise(number_churn = n()) %>%
ggplot(aes(x = partner,
y = number_churn,
fill = churn)) %>%
geom_col(position = "dodge")
telco_clean %>%
group_by(partner, churn) %>%
summarise(number_churn = n()) %>%
ggplot(aes(x = partner,
y = number_churn,
fill = churn)) +
geom_col(position = "dodge")
telco_clean %>%
group_by(partner, churn) %>%
summarise(number_churn = n()) %>%
ggplot(aes(x = partner,
y = number_churn,
fill = churn)) +
geom_col(position = "dodge")
telco_clean %>%
group_by(senior_citizen, churn) %>%
summarise(number_churn = n()) %>%
ggplot(aes(x = senior_citizen,
y = number_churn,
fill = churn)) +
geom_col(position = "dodge")
#model with partner
mod_partner <- glm(churn ~ partner,
data = telco_clean,
family = binomial(link = "logit"))
mod_partner_pred <- telco_clean %>%
add_predictions(model = mod_partner) %>%
mutate(pred_churn = pred >= 0.60)
summary(mod_partner)
#model with tenure
mod_tenure <- glm(churn ~ tenure,
data = telco_clean,
family = binomial(link = "logit"))
mod_tenure_pred <- telco_clean %>%
add_predictions(model = mod_tenure) %>%
mutate(pred_churn = pred >= 0.60)
summary(mod_tenure)
#model with monthly_charges
mod_monthly_charges <- glm(churn ~ monthly_charges,
data = telco_clean,
family = binomial(link = "logit"))
mod_monthly_charges_pred <- telco_clean %>%
add_predictions(model = mod_monthly_charges) %>%
mutate(pred_churn = pred >= 0.60)
summary(mod_monthly_charges)
summary(mod_monthly_charges)
summary(mod_tenure)
library(pROC)
View(mod_partner_pred)
#model with partner
mod_partner <- glm(churn ~ partner,
data = telco_clean,
family = binomial("logit"))
mod_partner_pred <- telco_clean %>%
add_predictions(model = mod_partner) %>%
mutate(pred_churn = pred >= 0.60)
summary(mod_partner)
mod_partner_pred %>% skimr::skim()
#model with partner
mod_partner <- glm(churn ~ partner,
data = telco_clean,
family = binomial(link = "logit"))
mod_partner_pred <- telco_clean %>%
add_predictions(model = mod_partner, type = "response") %>%
mutate(pred_churn = pred >= 0.60)
summary(mod_partner)
mod_partner_pred %>% skimr::skim()
#model with tenure
mod_tenure <- glm(churn ~ tenure,
data = telco_clean,
family = binomial("logit"))
mod_tenure_pred <- telco_clean %>%
add_predictions(model = mod_tenure, type = "response") %>%
mutate(pred_churn = pred >= 0.60)
summary(mod_tenure)
#model with monthly_charges
mod_monthly_charges <- glm(churn ~ monthly_charges,
data = telco_clean,
family = binomial("logit"))
mod_monthly_charges_pred <- telco_clean %>%
add_predictions(model = mod_monthly_charges, type = "response") %>%
mutate(pred_churn = pred >= 0.60)
summary(mod_monthly_charges)
mod_tenure_pred %>% skimr::skim()
mod_monthly_charges_pred %>% skimr::skim()
ggplot(telco_clean) +
geom_jitter(aes(x = monthly_charges,
y = as.numeric(churn)),
alpha = 0.5, height = 0.1, width = 0.1)
telco_churn %>%
filter(!is.na(total_charges)) %>%
select(-customer_id) %>%
mutate(across(where(is_character), as_factor)) %>%
mutate(senior_citizen = as_factor(if_else(senior_citizen == 1, "Yes", "No"))) %>%
mutate(churn_logical = churn == "yes", .after = churn)
telco_churn %>%
filter(!is.na(total_charges)) %>%
select(-customer_id) %>%
mutate(across(where(is_character), as_factor)) %>%
mutate(senior_citizen = as_factor(if_else(senior_citizen == 1, "Yes", "No"))) %>%
mutate(churn_logical = churn == "Yes", .after = churn)
telco_clean <- telco_churn %>%
filter(!is.na(total_charges)) %>%
select(-customer_id) %>%
mutate(across(where(is_character), as_factor)) %>%
mutate(senior_citizen = as_factor(if_else(senior_citizen == 1, "Yes", "No"))) %>%
mutate(churn = churn == "Yes")
ggplot(telco_clean) +
geom_jitter(aes(x = monthly_charges,
y = as.numeric(churn)),
alpha = 0.5, height = 0.1, width = 0.1)
mod_monthly_charges_pred %>% skimr::skim()
mod_monthly_charges_pred %>% skimr::skim()
View(mod_tenure_pred)
View(mod_monthly_charges_pred)
#model with partner
mod_partner <- glm(churn ~ partner,
data = telco_clean,
family = binomial(link = "logit"))
mod_partner_pred <- telco_clean %>%
add_predictions(model = mod_partner, type = "response") %>%
mutate(pred_churn = pred >= 0.30)
summary(mod_partner)
#model with tenure
mod_tenure <- glm(churn ~ tenure,
data = telco_clean,
family = binomial("logit"))
mod_tenure_pred <- telco_clean %>%
add_predictions(model = mod_tenure, type = "response") %>%
mutate(pred_churn = pred >= 0.30)
summary(mod_tenure)
#model with monthly_charges
mod_monthly_charges <- glm(churn ~ monthly_charges,
data = telco_clean,
family = binomial("logit"))
mod_monthly_charges_pred <- telco_clean %>%
add_predictions(model = mod_monthly_charges, type = "response") %>%
mutate(pred_churn = pred >= 0.30)
summary(mod_monthly_charges)
ggplot(telco_clean) +
geom_jitter(aes(x = monthly_charges,
y = as.numeric(churn)),
alpha = 0.5, height = 0.1, width = 0.1) +
geom_line(data = mod_monthly_charges_pred,
aes(x = monthly_charges,
y = pred), col = "red")+
labs(y = "Estimated p(churn)")
roc_obj_partner <- mod_partner_pred %>%
roc(response = churn, predictor = pred)
roc_obj_tenure <- mod_tenure_pred %>%
roc(response = churn, predictor = pred)
roc_obj_monthly_charges <- mod_monthly_charges_pred %>%
roc(response = churn, predictor = pred)
ggroc(data = list(partner = roc_obj_partner,
tenure = roc_obj_tenure,
monthly_charges = roc_obj_monthly_charges),
legacy.axes = TRUE)+
labs(x = "False Positive Rate", y = "True Positive Rate")
auc(mod_monthly_charges)
auc(mod_monthly_charges_pred)
auc(roc_obj_monthly_charges)
auc(roc_obj_partner)
auc(roc_obj_tenure)
ggplot(telco_clean) +
geom_jitter(aes(x = tenure,
y = as.numeric(churn)),
alpha = 0.5, height = 0.1, width = 0.1) +
geom_line(data = mod_tenure_pred,
aes(x = tenure,
y = pred), col = "red")+
labs(y = "Estimated p(churn)")
library(janitor)
mod_tenure_pred %>%
tabyl(churn, pred_churn) %>%
adorn_title()
summary(mod_tenure)
exp(b1 * change)
odds_change <- function(b1, change){
exp(b1 * change)
}
odds_change(-0.039010, 12)
summary(mod_tenure)
ggplot(telco_clean) +
geom_jitter(aes(x = tenure,
y = as.numeric(churn)),
alpha = 0.5, height = 0.1, width = 0.1) +
geom_line(data = mod_tenure_pred,
aes(x = tenure,
y = pred), col = "red")+
labs(y = "Estimated p(churn)")
#so the coefficient for tenure was -0.039 and we're interested in a change of 12 months in tenure
odds_change(-0.039010, 1)
#so the coefficient for tenure was -0.039 and we're interested in a change of 12 months in tenure
odds_change(-0.039010, 12)
